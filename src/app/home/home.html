<div class="home-container">
  <div class="header-section">
    <h1>Talent Finder</h1>
    <p>Discover amazing services from talented professionals</p>
  </div>

  <!-- Filter Panel -->
  <mat-expansion-panel class="filter-panel" [expanded]="true">
    <mat-expansion-panel-header>
      <mat-panel-title>
        <mat-icon>filter_list</mat-icon>
        <span>Filter Services</span>
      </mat-panel-title>
    </mat-expansion-panel-header>

    <form [formGroup]="filterForm" class="filter-form">
      <div class="filter-row">
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Search by Service Title</mat-label>
          <input matInput
                 formControlName="serviceName"
                 placeholder="Enter service title...">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Search by Owner Username</mat-label>
          <input matInput
                 formControlName="username"
                 placeholder="Enter username...">
          <mat-icon matSuffix>person</mat-icon>
        </mat-form-field>
      </div>

      <div class="filter-row">
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Category</mat-label>
          <mat-select formControlName="categoryName">
            <mat-option value="">All Categories</mat-option>
            <mat-option *ngFor="let category of categories" [value]="category.name">
              {{ category.name }}
            </mat-option>
          </mat-select>
          <mat-icon matSuffix>category</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Location</mat-label>
          <mat-select formControlName="location">
            <mat-option value="">All Locations</mat-option>
            <mat-option *ngFor="let location of locations" [value]="location.locationName">
              {{ location.locationName }}
            </mat-option>
          </mat-select>
          <mat-icon matSuffix>location_on</mat-icon>
        </mat-form-field>
      </div>

      <div class="filter-row">
        <mat-form-field appearance="outline" class="filter-field price-field">
          <mat-label>Min Price (€)</mat-label>
          <input matInput
                 type="number"
                 formControlName="minPrice"
                 placeholder="0"
                 min="0"
                 step="0.01">
          <mat-icon matSuffix>euro</mat-icon>
          <mat-error *ngIf="getFieldError('minPrice')">
            {{ getFieldError('minPrice') }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field price-field">
          <mat-label>Max Price (€)</mat-label>
          <input matInput
                 type="number"
                 formControlName="maxPrice"
                 placeholder="1000"
                 min="0"
                 step="0.01">
          <mat-icon matSuffix>euro</mat-icon>
          <mat-error *ngIf="getFieldError('maxPrice')">
            {{ getFieldError('maxPrice') }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="filter-actions">
        <button mat-raised-button
                color="primary"
                (click)="onSearch()"
                [disabled]="loading">
          <mat-icon>search</mat-icon>
          Search
        </button>

        <button mat-stroked-button
                (click)="onClear()"
                [disabled]="loading">
          <mat-icon>clear</mat-icon>
          Clear Filters
        </button>
      </div>
    </form>
  </mat-expansion-panel>

  <!-- Error Message for Price Validation -->
  <div *ngIf="error && !loading" class="error-container">
    <p class="error-message">{{ error }}</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading services...</p>
  </div>

  <!-- Services Grid -->
  <div *ngIf="!loading && !error && services.length > 0" class="services-grid">
    <div class="results-header">
      <h2>{{ services.length }} Service(s) Found</h2>
    </div>

    <mat-grid-list
      [cols]="getCols()"
      rowHeight="400px"
      gutterSize="20px">

      <mat-grid-tile *ngFor="let service of services">
        <mat-card
          class="service-card"
          (click)="onServiceClick(service)"
          [attr.aria-label]="'Service: ' + service.title">

          <!-- Service Image -->
          <div class="image-container">
            <img
              mat-card-image
              [src]="service.mainPicture"
              [alt]="service.title"
              (error)="onImageError($event)"
              class="service-image">

            <!-- Category Chip -->
            <mat-chip-set class="category-chip">
              <mat-chip *ngIf="service.serviceCategory">
                {{ service.serviceCategory }}
              </mat-chip>
            </mat-chip-set>
          </div>

          <!-- Card Content -->
          <mat-card-content class="card-content">
            <div class="service-info">
              <h3 class="service-title" [title]="service.title">
                {{ service.title }}
              </h3>

              <div class="owner-info">
                <span class="owner-name">
                  by {{ service.user.username }}
                </span>
              </div>

              <div class="price-section">
                <span class="price">
                  €{{ service.price | number:'1.2-2' }}
                </span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </mat-grid-tile>
    </mat-grid-list>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && services.length === 0" class="empty-state">
    <h2>No services found</h2>
    <p>Try adjusting your search criteria or clear filters to see all services.</p>
  </div>
</div>
